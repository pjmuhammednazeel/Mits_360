<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>360¬∞ Panoramic View</title>
    
    <!-- Panellum CSS -->
    <link rel="stylesheet" href="https://cdn.pannellum.org/2.5/pannellum.css"/>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        #panorama {
            width: 100vw;
            height: 100vh;
            animation: fadeIn 0.6s ease-in-out;
        }
        
        #panorama.fade-out {
            animation: fadeOut 0.4s ease-in-out forwards;
        }
        
        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.05);
            }
        }
        
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(0.95);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .transition-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 999;
            animation: overlayFade 0.4s ease-in-out;
        }
        
        .transition-overlay.show {
            display: block;
        }
        
        @keyframes overlayFade {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
        
        .info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            z-index: 1000;
            font-size: 14px;
        }
        
        .info h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .info p {
            margin: 5px 0;
            font-size: 12px;
            opacity: 0.9;
        }
        
        .nav-arrow {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .nav-arrow:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }
        
        .nav-arrow.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .nav-arrow.disabled:hover {
            transform: translateX(-50%) scale(1);
        }
        
        #prev-arrow {
            bottom: 30px;
            display: flex !important;
        }
        
        #next-arrow {
            bottom: 100px;
            display: flex !important;
        }
        
        #side-arrow {
            left: 50%;
            bottom: 100px;
            transform: translateX(-50%);
            display: none;
            margin-left: -80px;
        }
        
        #side-arrow:hover {
            transform: translateX(-50%) scale(1.1);
        }
        
        #side-arrow.show {
            display: flex;
        }
        
        #back-arrow {
            display: none !important;
        }
        
        #mainroad-button {
            position: fixed !important;
            right: 10px !important;
            bottom: 10px !important;
            left: auto !important;
            transform: none !important;
            display: none;
            width: 50px;
            height: 50px;
            padding: 0;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }
        
        #mainroad-button:hover {
            transform: scale(1.1);
        }
        
        #mainroad-button.show {
            display: flex;
        }
        
        #home-arrow {
            left: 50%;
            bottom: 100px;
            transform: translateX(-50%);
            display: none;
            margin-left: 80px;
        }
        
        #home-arrow:hover {
            transform: translateX(-50%) scale(1.1);
        }
        
        #home-arrow.show {
            display: flex;
        }
        
        #home-back-arrow {
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            display: none;
        }
        
        #home-back-arrow:hover {
            transform: translateX(-50%) scale(1.1);
        }
        
        #home-back-arrow.show {
            display: flex;
        }
        
        #left-arrow {
            left: 30px;
            bottom: 50%;
            transform: translateY(50%);
            display: none;
        }
        
        #left-arrow.show {
            display: flex;
        }
        
        #left-arrow:hover {
            transform: translateY(50%) scale(1.1);
        }
        
        .nav-arrow svg {
            width: 30px;
            height: 30px;
            fill: #333;
        }
        
        .counter {
            position: absolute;
            bottom: 200px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1000;
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="info">
        <h2>360¬∞ Panoramic View</h2>
        <p>üñ±Ô∏è Drag to look around</p>
        <p>üîç Scroll to zoom</p>
        <p>‚¨ÜÔ∏è‚¨áÔ∏è Navigate scenes</p>
    </div>
    
    <div class="transition-overlay" id="transition-overlay"></div>
    
    <div id="panorama"></div>
    
    <!-- Navigation Arrows -->
    <div id="prev-arrow" class="nav-arrow">
        <svg viewBox="0 0 24 24">
            <path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/>
        </svg>
    </div>
    
    <div id="next-arrow" class="nav-arrow">
        <svg viewBox="0 0 24 24">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </div>
    
    <div id="side-arrow" class="nav-arrow" onclick="goToIndoor()">
        <svg viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
        </svg>
    </div>
    
    <div id="back-arrow" class="nav-arrow back-button" onclick="handleBackArrow()">
        <span style="font-size: 16px; font-weight: bold; color: #333;">Back</span>
    </div>
    
    <div id="mainroad-button" class="nav-arrow" onclick="handleMainRoadButton()">
        <span style="font-size: 10px; font-weight: bold; color: #333; text-align: center; white-space: normal; line-height: 1.2;">Back</span>
    </div>
    
    <div id="home-arrow" class="nav-arrow" onclick="goToHome()">
        <svg viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
        </svg>
    </div>
    
    <div id="home-back-arrow" class="nav-arrow" onclick="goBackToOutdoorFromHome()">
        <svg viewBox="0 0 24 24">
            <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
        </svg>
    </div>
    
    <div id="left-arrow" class="nav-arrow" onclick="handleLeftArrow()">
        <svg viewBox="0 0 24 24">
            <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"/>
        </svg>
    </div>
    
    <div class="counter" id="counter">1 / 16</div>
    
    <!-- Panellum JavaScript -->
    <script src="https://cdn.pannellum.org/2.5/pannellum.js"></script>
    
    <script>
        console.log('Starting Panellum...');
        
        // Array of panorama scenes for Main Road
        const scenes = {};
        
        // Generate scenes for Main Road 1-16
        for (let i = 1; i <= 16; i++) {
            scenes[`mainroad_${i}`] = {
                "type": "equirectangular",
                "panorama": `assets/Main_Road/Main_Road_${i}.jpg`,
                "autoLoad": true,
                "showZoomCtrl": true,
                "showFullscreenCtrl": true,
                "mouseZoom": true,
                "hfov": 120,
                "minHfov": 60,
                "maxHfov": 120,
                "pitch": 0,
                "yaw": 0
            };
        }
        
        // Generate scenes for BSchool 1-5 and Step_1
        const bschoolImages = ['BSchool_1', 'BSchool_2', 'BSchool_3', 'BSchool_4', 'BSchool_5', 'Step_1', 'BSchool_1.1', 'Step_2', 'BSchool_2.1', 'BSchool_2.2', 'BSchool_2.3', 'BSchool_2.4', 'BSchool_2.5', 'BSchool_2.6'];
        for (let i = 0; i < bschoolImages.length; i++) {
            scenes[`bschool_${i + 1}`] = {
                "type": "equirectangular",
                "panorama": `assets/BSchool/${bschoolImages[i]}.jpg`,
                "autoLoad": true,
                "showZoomCtrl": true,
                "showFullscreenCtrl": true,
                "mouseZoom": true,
                "hfov": 120,
                "minHfov": 60,
                "maxHfov": 120,
                "pitch": 0,
                "yaw": 0
            };
        }
        
        // Generate scenes for BSchool_1.2 to 1.4 (sub-collection)
        const bschool1SubImages = ['BSchool_1.2', 'BSchool_1.3', 'BSchool_1.4'];
        for (let i = 0; i < bschool1SubImages.length; i++) {
            scenes[`bschool1sub_${i + 1}`] = {
                "type": "equirectangular",
                "panorama": `assets/BSchool/${bschool1SubImages[i]}.jpg`,
                "autoLoad": true,
                "showZoomCtrl": true,
                "showFullscreenCtrl": true,
                "mouseZoom": true,
                "hfov": 120,
                "minHfov": 60,
                "maxHfov": 120,
                "pitch": 0,
                "yaw": 0
            };
        }
        
        const mainroadScenes = Array.from({length: 16}, (_, i) => `mainroad_${i + 1}`);
        const bschoolScenes = Array.from({length: 14}, (_, i) => `bschool_${i + 1}`);
        const bschool1SubScenes = Array.from({length: 3}, (_, i) => `bschool1sub_${i + 1}`);
        let currentIndex = 0;
        let currentScene = 'mainroad_1';
        let currentCollection = 'mainroad'; // Track which collection we're in
        let viewer;
        
        // Initialize the viewer
        function initViewer(sceneId) {
            if (viewer) {
                viewer.destroy();
            }
            
            const config = {
                "default": {
                    "firstScene": sceneId
                },
                "scenes": scenes
            };
            
            viewer = pannellum.viewer('panorama', config);
            
            viewer.on('error', function(err) {
                console.error('Panellum error:', err);
                alert('Error loading panorama: ' + err);
            });
            
            viewer.on('load', function() {
                console.log('Panorama loaded successfully!');
            });
            
            currentScene = sceneId;
            updateUI();
        }
        
        let isNavigating = false; // Flag to prevent multiple clicks during animation
        
        // Navigate between panoramas with Street View-style animation
        function navigatePanorama(direction) {
            if (isNavigating) return; // Prevent multiple clicks during animation
            
            let currentSceneArray;
            if (currentCollection === 'mainroad') {
                currentSceneArray = mainroadScenes;
            } else if (currentCollection === 'bschool') {
                currentSceneArray = bschoolScenes;
            } else if (currentCollection === 'bschool1_sub') {
                currentSceneArray = bschool1SubScenes;
            }
            
            const newIndex = currentIndex + direction;
            
            if (newIndex >= 0 && newIndex < currentSceneArray.length) {
                isNavigating = true; // Set flag to prevent other clicks
                
                // Start fade out animation
                const panorama = document.getElementById('panorama');
                const overlay = document.getElementById('transition-overlay');
                
                panorama.classList.add('fade-out');
                overlay.classList.add('show');
                
                // Wait for animation to complete, then load new scene
                setTimeout(() => {
                    currentIndex = newIndex;
                    currentScene = currentSceneArray[currentIndex];
                    viewer.loadScene(currentScene);
                    
                    // Remove fade-out class and reset
                    panorama.classList.remove('fade-out');
                    overlay.classList.remove('show');
                    updateUI();
                    
                    isNavigating = false; // Allow navigation again
                }, 400);
            }
        }
        
        // Go to indoor scene (not applicable for Main Road)
        function goToIndoor() {
            // Placeholder - not needed for Main Road
        }
        
        // Go back to outdoor scene (not applicable for Main Road)
        function goBackToOutdoor() {
            // Placeholder - not needed for Main Road
        }
        
        // Go to home scene (not applicable for Main Road)
        function goToHome() {
            // Placeholder - not needed for Main Road
        }
        
        // Go back to outdoor from home (not applicable for Main Road)
        function goBackToOutdoorFromHome() {
            // Placeholder - not needed for Main Road
        }
        
        // Navigate to BSchool from Main Road 5
        function goToBSchool() {
            const panorama = document.getElementById('panorama');
            const overlay = document.getElementById('transition-overlay');
            
            panorama.classList.add('fade-out');
            overlay.classList.add('show');
            
            setTimeout(() => {
                currentCollection = 'bschool';
                currentIndex = 0;
                currentScene = bschoolScenes[0];
                viewer.loadScene(currentScene);
                
                panorama.classList.remove('fade-out');
                overlay.classList.remove('show');
                updateUI();
            }, 400);
        }
        
        // Navigate back from BSchool to Main Road 5
        function goBackFromBSchool() {
            const panorama = document.getElementById('panorama');
            const overlay = document.getElementById('transition-overlay');
            
            panorama.classList.add('fade-out');
            overlay.classList.add('show');
            
            setTimeout(() => {
                currentCollection = 'mainroad';
                currentIndex = 4; // Main Road 5 is at index 4
                currentScene = mainroadScenes[4];
                viewer.loadScene(currentScene);
                
                panorama.classList.remove('fade-out');
                overlay.classList.remove('show');
                updateUI();
            }, 400);
        }
        
        // Handle back arrow - route to appropriate function
        function handleBackArrow() {
            if (currentCollection === 'bschool') {
                goBackFromBSchool();
            } else {
                goBackToOutdoor();
            }
        }
        
        // Navigate to BSchool 1 sub-collection from BSchool_1.1
        function goToBSchool1Sub() {
            const panorama = document.getElementById('panorama');
            const overlay = document.getElementById('transition-overlay');
            
            panorama.classList.add('fade-out');
            overlay.classList.add('show');
            
            setTimeout(() => {
                currentCollection = 'bschool1_sub';
                currentIndex = 0;
                currentScene = bschool1SubScenes[0];
                viewer.loadScene(currentScene);
                
                panorama.classList.remove('fade-out');
                overlay.classList.remove('show');
                updateUI();
            }, 400);
        }
        
        // Navigate back from BSchool 1 sub-collection to BSchool_1.1
        function goBackFromBSchool1Sub() {
            const panorama = document.getElementById('panorama');
            const overlay = document.getElementById('transition-overlay');
            
            panorama.classList.add('fade-out');
            overlay.classList.add('show');
            
            setTimeout(() => {
                currentCollection = 'bschool';
                currentIndex = 6; // BSchool_1.1 is at index 6
                currentScene = bschoolScenes[6];
                viewer.loadScene(currentScene);
                
                panorama.classList.remove('fade-out');
                overlay.classList.remove('show');
                updateUI();
            }, 400);
        }
        
        // Handle Main Road button - route to appropriate function
        function handleMainRoadButton() {
            if (currentCollection === 'bschool') {
                goBackFromBSchool();
            } else if (currentCollection === 'bschool1_sub') {
                goBackFromBSchool1Sub();
            }
        }
        
        // Handle left arrow - route to appropriate function
        function handleLeftArrow() {
            if (currentCollection === 'mainroad' && currentIndex === 4) {
                goToBSchool();
            } else if (currentCollection === 'bschool' && currentIndex === 6) {
                goToBSchool1Sub();
            }
        }
        
        // Update UI elements
        function updateUI() {
            const sideArrow = document.getElementById('side-arrow');
            const backArrow = document.getElementById('back-arrow');
            const homeArrow = document.getElementById('home-arrow');
            const homeBackArrow = document.getElementById('home-back-arrow');
            const leftArrow = document.getElementById('left-arrow');
            const mainroadButton = document.getElementById('mainroad-button');
            const counter = document.getElementById('counter');
            const prevArrow = document.getElementById('prev-arrow');
            const nextArrow = document.getElementById('next-arrow');
            
            // Hide all special arrows
            sideArrow.classList.remove('show');
            backArrow.classList.remove('show');
            homeArrow.classList.remove('show');
            homeBackArrow.classList.remove('show');
            leftArrow.classList.remove('show');
            mainroadButton.classList.remove('show');
            
            if (currentCollection === 'mainroad') {
                // Update counter for Main Road scenes
                currentIndex = mainroadScenes.indexOf(currentScene);
                counter.textContent = `${currentIndex + 1} / ${mainroadScenes.length}`;
                counter.style.display = 'block';
                prevArrow.style.display = 'flex';
                nextArrow.style.display = 'flex';
                
                if (currentIndex === 0) {
                    prevArrow.classList.add('disabled');
                } else {
                    prevArrow.classList.remove('disabled');
                }
                
                if (currentIndex === mainroadScenes.length - 1) {
                    nextArrow.classList.add('disabled');
                } else {
                    nextArrow.classList.remove('disabled');
                }
                
                // Show left arrow only on Main Road 5 (index 4)
                if (currentIndex === 4) {
                    leftArrow.classList.add('show');
                }
            } else if (currentCollection === 'bschool') {
                // Update counter for BSchool scenes
                currentIndex = bschoolScenes.indexOf(currentScene);
                counter.textContent = `${currentIndex + 1} / ${bschoolScenes.length}`;
                counter.style.display = 'block';
                prevArrow.style.display = 'flex';
                nextArrow.style.display = 'flex';
                
                if (currentIndex === 0) {
                    prevArrow.classList.add('disabled');
                } else {
                    prevArrow.classList.remove('disabled');
                }
                
                if (currentIndex === bschoolScenes.length - 1) {
                    nextArrow.classList.add('disabled');
                } else {
                    nextArrow.classList.remove('disabled');
                }
                
                // Show Main Road button to return to Main Road 5
                mainroadButton.classList.add('show');
                
                // Show left arrow on BSchool_1.1 (index 6)
                if (currentIndex === 6) {
                    leftArrow.classList.add('show');
                }
            } else if (currentCollection === 'bschool1_sub') {
                // Update counter for BSchool 1 sub scenes
                currentIndex = bschool1SubScenes.indexOf(currentScene);
                counter.textContent = `${currentIndex + 1} / ${bschool1SubScenes.length}`;
                counter.style.display = 'block';
                prevArrow.style.display = 'flex';
                nextArrow.style.display = 'flex';
                
                if (currentIndex === 0) {
                    prevArrow.classList.add('disabled');
                } else {
                    prevArrow.classList.remove('disabled');
                }
                
                if (currentIndex === bschool1SubScenes.length - 1) {
                    nextArrow.classList.add('disabled');
                } else {
                    nextArrow.classList.remove('disabled');
                }
                
                // Show Main Road button to return to BSchool_1.1
                mainroadButton.classList.add('show');
            }
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (currentCollection === 'mainroad' || currentCollection === 'bschool' || currentCollection === 'bschool1_sub') {
                if (e.key === 'ArrowDown') {
                    navigatePanorama(-1);
                } else if (e.key === 'ArrowUp') {
                    navigatePanorama(1);
                }
            }
        });
        
        // Initialize with first panorama
        initViewer('mainroad_1');
        
        // Add event listeners for navigation arrows
        document.getElementById('prev-arrow').addEventListener('click', function(e) {
            e.preventDefault();
            if (!this.classList.contains('disabled')) {
                navigatePanorama(-1);
            }
        });
        
        document.getElementById('next-arrow').addEventListener('click', function(e) {
            e.preventDefault();
            if (!this.classList.contains('disabled')) {
                navigatePanorama(1);
            }
        });
    </script>
</body>
</html>
